@using CMC.Web.Services
@inherits Microsoft.AspNetCore.Components.ComponentBase
@inject EditDrawerService DrawerService
@implements IDisposable

<!-- Wir geben den Request als Parameter an EditDrawer weiter -->
<EditDrawer Request="@_currentRequest" />

@code {
    private EditDrawerRequest? _currentRequest;

    protected override void OnInitialized()
    {
        DrawerService.OpenRequested += OnOpenRequested;
        DrawerService.CloseRequested += OnCloseRequested;
    }

    private void OnOpenRequested(EditDrawerRequest req)
    {
        // direkte Parameterversorgung -> Drawer rendert sofort auf
        _currentRequest = req;
        InvokeAsync(StateHasChanged);
        Console.WriteLine($"EditHost: Open '{req.Title}'");
    }

    private void OnCloseRequested()
    {
        _currentRequest = null;
        InvokeAsync(StateHasChanged);
        Console.WriteLine("EditHost: Close");
    }

    public void Dispose()
    {
        DrawerService.OpenRequested -= OnOpenRequested;
        DrawerService.CloseRequested -= OnCloseRequested;
    }
}
