@using CMC.Web.Pages.FormFields
@inherits FormFieldBase

<div class="form-row @(Errors?.Length > 0 ? "is-invalid" : null)">
    <label class="form-label">
        <input type="checkbox"
               checked="@IsChecked"
               disabled="@ReadOnly"
               @onchange="HandleChange"
               @attributes="AdditionalAttributes" />
        <span class="switch-track"></span>
        @Label
    </label>

    @if (!string.IsNullOrWhiteSpace(Hint))
    { <div class="form-hint">@Hint</div> }
    @if (Errors?.Length > 0)
    {
        <div class="field-error">
            @foreach (var e in Errors) { <div>@e</div> }
        </div>
    }
</div>

@code {
    private bool IsChecked => Value is bool b && b;

    private async Task HandleChange(ChangeEventArgs e)
    {
        bool? newValue = null;
        if (e.Value is bool b) newValue = b;
        else if (e.Value?.ToString() == "on") newValue = true;
        else if (bool.TryParse(e.Value?.ToString(), out var parsed)) newValue = parsed;

        await OnChanged(newValue);
    }
}
